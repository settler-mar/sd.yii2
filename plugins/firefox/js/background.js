function toggleIcon(){var a=defaultIcon?"img/favicon-32x32-little.png":"img/favicon-32x32.png";defaultIcon=!defaultIcon;var e=storeCashback?storeCashback.toString():"";chrome.browserAction.setIcon({path:a}),chrome.browserAction.setBadgeBackgroundColor({color:"#666"}),e=e.replace(/^\s+/,""),chrome.browserAction.setBadgeText({text:e}),stop&&defaultIcon&&clearInterval(iconFlashInterval)}function iconFlashStart(a){storeCashback=a,stop&&(defaultIcon=!0,clearInterval(iconFlashInterval),toggleIcon(),iconFlashInterval=setInterval(toggleIcon,iconFlashTime)),stop=!1,clearTimeout(iconFlashIntervalMax),iconFlashIntervalMax=setTimeout(iconFlashStop,maxFlashInterval)}function iconFlashStop(){stop=!0}function iconFlashClearCashback(){storeCashback=!1,stop?chrome.browserAction.setBadgeText({text:""}):stop=!0}function encodeQueryData(a){var e=[];for(var o in a)e.push(encodeURIComponent(o)+"="+encodeURIComponent(a[o]));return e.join("&")}var showCashback=!0,iconFlashInterval,iconFlashIntervalMax,defaultIcon=!0,iconFlashTime=300,stop=!0,maxFlashInterval=1e4,storeCashback=!1;chrome.runtime.onMessage.addListener(function(a,e,o){if("sd_xhttp"==a.action){var t=new XMLHttpRequest,n=a.method||"GET";return"GET"===n?a.url+="?g=plugin":"POST"===n.toUpperCase()&&(a.data.g="plugin"),t.open(n,a.url,!0),t.responseType="json",t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==t.readyState&&o(t.response)},t.send(encodeQueryData(a.data)),!0}"icon_flash_start"===a.action&&iconFlashStart(a.cashback),"icon_flash_stop"===a.action&&iconFlashStop(),"icon_flash_clear_cashback"===a.action&&iconFlashClearCashback()});