function closeClick(){var e=this.getAttribute("data-store");storeUtil.setPopupClosed(e),document.querySelector(".secretdiscounter-extension").style.display="none"}function getUsers(){debug&&console.log("getusers"),chrome.runtime.sendMessage({action:"sd_xhttp",url:siteUrl+userUrl},function(e){debug&&console.log("getusers success",e),usersData=e})}function changeFavorite(e){e.preventDefault();var t=this,r=t.getAttribute("data-id"),s=t.getAttribute("data-type");t.onclick=null,chrome.runtime.sendMessage({action:"sd_xhttp",method:"POST",url:siteUrl+userFavoriteUrl,data:{affiliate_id:r,type:s}},function(e){if(t.onclick=changeFavorite,!e.error){if("add"===s)usersData.user.favorites.push(r);else{var a=usersData.user.favorites.indexOf(r);a>-1&&usersData.user.favorites.splice(a,1)}displayFavoriteLinks(r)}})}function displayFavoriteLinks(e){return usersData&&usersData.user?void(!usersData.user.favorites||usersData.user.favorites.indexOf(e)<0?(document.querySelector('.secretdiscounter-extension__shop a[href="#vaforite_add"]').className="",document.querySelector('.secretdiscounter-extension__shop a[href="#vaforite_remove"]').className="sd_hidden"):(document.querySelector('.secretdiscounter-extension__shop a[href="#vaforite_add"]').className="sd_hidden",document.querySelector('.secretdiscounter-extension__shop a[href="#vaforite_remove"]').className="")):(document.querySelector('.secretdiscounter-extension__shop a[href="#vaforite_add"]').className="sd_hidden",document.querySelector('.secretdiscounter-extension__shop a[href="#vaforite_remove"]').className="sd_hidden",null)}function findShop(){if(debug&&console.log("findShop"),usersData!==!1)storeUtil.findShop(storageDataStores.stores,!1,displayShop);else var e=10,t=setInterval(function(){e--,debug&&console.log(usersData),usersData!==!1&&(storeUtil.findShop(storageDataStores.stores,!1,displayShop),clearInterval(t)),e<0&&clearInterval(t)},1e3)}function testDisplayPage(e){return debug&&console.log("display on page "+(void 0===e||null===e||1==e||3==e)),void 0===e||null===e||1==e||3==e}function displayShop(e){if(testDisplayPage(e.display)&&(e&&(chrome.runtime.sendMessage({action:"icon_flash_start",cashback:utils.makeCashback(e.displayed_cashback,e.currency,e.action_id,!0),tab_url:window.location.href}),setTimeout(function(){chrome.runtime.sendMessage({action:"icon_flash_stop"})},5e3)),div=document.querySelector(".secretdiscounter-extension"),e&&!div&&(debug||!storeUtil.popupClosed(e.store_route)&&!storeUtil.isActivated(e.store_route)))){var t="",r="",s="",a="";usersData&&usersData.user?(t=siteUrl+"goto/store:"+e.uid,a=siteUrl+"stores",r=siteUrl,s='<a title="Добавить в избранное" data-id="'+e.uid+'" data-type="add" class="" href="#vaforite_add">'+iconFavoriteClose+'</a><a title="Убрать из избранных" data-id="'+e.uid+'" data-type="delete" class="sd_hidden" href="#vaforite_remove">'+iconFavoriteOpen+"</a>"):(t=siteUrl+"stores/"+e.store_route+"#login",r=siteUrl+"#login",a=siteUrl+"stores#login");var o=utils.replaceTemplate(storageDataStores.searchtext,{cashback:utils.makeCashback(e.displayed_cashback,e.currency,e.action_id)}),i=storeUtil.isActivated(e.store_route),n=utils.replaceTemplate(storePluginHtml,{storeLogo:siteUrl+"images/logos/"+e.logo,storeUrl:t,storeText:o,siteUrl:r,favoritesLink:s,logoImage:logoImage,storeRoute:e.store_route,buttonsClass:i?"sd_hidden":"",storesUrl:a});div=document.createElement("div"),div.className="secretdiscounter-extension",div.innerHTML=n,div.style.right="20px",div.style.top="10px";var d=10,c=setInterval(function(){d--;var t=document.body;t&&(clearInterval(c),t.insertBefore(div,t.firstChild),document.querySelector(".secretdiscounter-extension__button_close").onclick=closeClick,usersData&&usersData.user&&(document.querySelector('.secretdiscounter-extension__shop-favorites  [href="#vaforite_add"]').onclick=changeFavorite,document.querySelector('.secretdiscounter-extension__shop-favorites  [href="#vaforite_remove"]').onclick=changeFavorite),displayFavoriteLinks(e.uid),utils.makeHrefs(document.querySelector(".secretdiscounter-extension__buttons"),utils.doClickPlugunClose)),d<0&&clearInterval(c)},1e3)}}function setAppId(){var e=document.createElement("div");e.id=appIds[currentBrowser].id,e.style="display:none;",document.body.appendChild(e),debug&&console.log(appIds[currentBrowser])}function getCookie(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return!!t&&decodeURIComponent(t[1])}function analizPage(){storeUtil.analizeActivated(),setAppId(),searchAnalize.analize(),searchAnalize.yandexHandlerSet()}var usersData=!1,isOpera=navigator.userAgent.indexOf(" OPR/")>=0,repeatTimes=!1,appIds={chrome:{id:"sd_chrome_app",search_delay:0},firefox:{id:"sd_firefox_app",search_delay:0},opera:{id:"sd_opera_app",search_delay:100},yandex:{id:"sd_yandex_app",search_delay:100}},currentBrowser="chrome";navigator.userAgent.indexOf(" OPR/")>=0?currentBrowser="opera":navigator.userAgent.indexOf(" YaBrowser/")>=0?currentBrowser="yandex":window.chrome&&window.chrome.webstore?currentBrowser="chrome":"undefined"!=typeof InstallTrigger&&(currentBrowser="firefox"),getUsers(),Storage.load(function(){storageDataDate=Storage.get(storageDataKeyDate),storageDataStores=Storage.get(storageDataKeyStores),debug&&console.log("storage load",storageDataStores,storageDataDate),!storageDataDate||!storageDataStores||storageDataDate+864e5<(new Date).getTime()?getData(findShop()):findShop()}),chrome.runtime.sendMessage({action:"icon_flash_clear"}),window.onload=analizPage;