function getImage(a,e,t){var n=document.createElement("canvas"),o=n.getContext("2d"),c=new Image,l=32,s=32,i=14,r=28,h=null;c.crossOrigin="anonymous",c.onload=function(){n.width=l,n.height=l,o.drawImage(this,0,0),e!==!1&&showCashback&&(o.font="bold "+(i+6)+"px ProximaNova",o.fillStyle="#333",o.fillRect(0,s-i-4,r,i+4),o.fillStyle="#fff",o.fillText(e,1,s-2)),h=o.getImageData(0,0,n.width,n.height),t(h)},c.src=a}function toggleIcon(){var a=defaultIcon?"img/favicon-32x32-little.png":"img/favicon-32x32.png";defaultIcon=!defaultIcon,getImage(a,storeCashback,function(a){chrome.browserAction.setIcon({imageData:a})}),stop&&defaultIcon&&clearInterval(iconFlashInterval)}function iconFlashStart(a){storeCashback=a,stop&&(defaultIcon=!0,clearInterval(iconFlashInterval),toggleIcon(),iconFlashInterval=setInterval(toggleIcon,iconFlashTime)),stop=!1,clearTimeout(iconFlashIntervalMax),iconFlashIntervalMax=setTimeout(iconFlashStop,maxFlashInterval)}function iconFlashStop(){storeCashback=!1,stop=!0}function encodeQueryData(a){var e=[];for(var t in a)e.push(encodeURIComponent(t)+"="+encodeURIComponent(a[t]));return e.join("&")}var showCashback=!0,iconFlashInterval,iconFlashIntervalMax,defaultIcon=!0,iconFlashTime=300,stop=!0,maxFlashInterval=1e4,storeCashback=!1;chrome.runtime.onMessage.addListener(function(a,e,t){if("sd_xhttp"==a.action){var n=new XMLHttpRequest,o=a.method||"GET";return"GET"===o?a.url+="?g=plugin":"POST"===o.toUpperCase()&&(a.data.g="plugin"),n.open(o,a.url,!0),n.responseType="json",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&t(n.response)},n.send(encodeQueryData(a.data)),!0}"icon_flash_start"===a.action&&iconFlashStart(a.cashback),"icon_flash_stop"===a.action&&iconFlashStop()});