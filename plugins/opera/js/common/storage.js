function Storage(){}Storage.configure=function(e){if(!chrome||!chrome.storage)throw new Error("The chrome.storage object is not available.");if(Storage._configured||Storage._loadingFlag||Storage._loaded)throw new Error("Storage can only be configured once and must be configured before the load method is called.");Storage._configured=!0;var o=e.scope;if(o){if(!/^(sync|local)$/.test(o))throw new Error('Invalid scope. Must be "local" or "sync"');Storage._scope=o}},Storage.load=function(e){e&&Storage._loadingQue.push(e),Storage._loadingFlag||(Storage._loadingFlag=!0,Storage._do("get",[null,function(e){for(var o in Storage._snapshot=e,Storage._loadingFlag=!1,Storage._loaded=!0,Storage._loadingQue)Storage._loadingQue[o](e);Storage._loadingQue=[],chrome.storage.onChanged.addListener(Storage._onChanged)}]))},Storage._snapshot={},Storage._scope="local",Storage._loaded=!1,Storage._loadingFlag=!1,Storage._loadingQue=[],Storage._configured=!1,Storage._debounceQue=[],Storage._debounceTimer=null,Storage._onChanged=function(e,o){if(o===Storage._scope)for(var r in e)Storage._snapshot[r]=e[r].newValue},Storage._do=function(e,o){Storage._debounceMethod(function(){chrome.storage[Storage._scope][e].apply(chrome.storage[Storage._scope],o)})},Storage._debounceMethod=function(e){Storage._debounceQue.push(e),Storage._debounceTimer=clearTimeout(Storage._debounceTimer),Storage._debounceTimer=setTimeout(Storage._onDebounceTimer.bind(Storage))},Storage._onDebounceTimer=function(){var e=[];for(var o in Storage._debounceQue)e.push(Storage._debounceQue[o]);for(var o in Storage._debounceQue=[],Storage._debounceTimer=null,e)e[o]()},Storage.get=function(e,o){if(!Storage._loaded)throw new Error("Storage.load must be called before you can access this method.");if(e===undefined||null===e)return Storage._snapshot;if("object"==typeof e){var r={};if(e.constructor===Array)for(var a in e)r[e[a]]=!0;else for(var a in e)r[a]=!0;for(var a in r)r[a]=Storage._snapshot[a];return r}var t=Storage._snapshot[e];return t===undefined?o:t},Storage.set=function(e,o,r){if(!Storage._loaded)throw new Error("Storage.load must be called before you can access this method.");var a={};"object"==typeof e?(a=e,r=o):a[e]=o;var t={},n={},g=!1,d=!1;for(var c in a)a[c]===undefined||null===a[c]?(t[c]=a[c],g=!0,delete Storage._local[c]):(n[c]=a[c],d=!0,Storage._snapshot[c]=a[c]);g&&Storage._do("remove",[t]),d?Storage._do("set",[n,r]):r&&r()},Storage.remove=function(e){if(!Storage._loaded)throw new Error("Storage.load must be called before you can access this method.");var o="object"==typeof e?e:[e],r={};for(var a in o)r[o[a]]=undefined;Storage.set(r)},Storage.clear=function(e){if(!Storage._loaded)throw new Error("Storage.load must be called before you can access this method.");Storage._snapshot={},Storage._do("clear",[e])};