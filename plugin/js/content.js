var logoImage = '<svg xmlns="http://www.w3.org/2000/svg" class="cd-logo_big" width="170" height="20" viewBox="0 0 97.278526 7.7622132" version="1.1" id="svg3775"><defs id="defs3769"/><g id="layer1" transform="translate(-5.5712741,-9.242112)"><path d="m 93.978818,10.621252 c -0.330729,0 -0.601927,0.271198 -0.601927,0.601927 v 3.800078 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 2.599531 c 0.327422,0 0.59862,-0.271198 0.59862,-0.601927 0,-0.330729 -0.271198,-0.59862 -0.59862,-0.59862 h -2.000912 v -0.701145 h 2.000912 c 0.327422,0 0.59862,-0.271198 0.59862,-0.59862 0,-0.330729 -0.271198,-0.601927 -0.59862,-0.601927 h -2.000912 v -0.697839 h 2.000912 c 0.327422,0 0.59862,-0.271198 0.59862,-0.601927 0,-0.330729 -0.271198,-0.601927 -0.59862,-0.601927 z m 7.669612,1.203854 v 0.697839 h -2.599534 v -0.697839 z m -3.800081,-0.601927 v 3.800078 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 0.330729,0 0.59862,-0.271198 0.59862,-0.601927 v -1.299765 h 1.051724 l 1.72309,1.726406 c 0.23482,0.234818 0.61847,0.23151 0.84998,0 0.23481,-0.234818 0.23481,-0.615156 0,-0.849974 l -0.87313,-0.876432 h 0.46302 0.0298 l 0.0331,-0.0033 0.0265,-0.0033 0.0298,-0.0066 0.0298,-0.0099 0.0298,-0.0066 0.0264,-0.0099 0.0265,-0.01323 0.0265,-0.0099 0.0265,-0.01654 0.0232,-0.01323 0.0265,-0.01654 0.0198,-0.01654 0.0231,-0.01984 0.0232,-0.01984 0.0199,-0.01984 0.0198,-0.01984 0.0165,-0.02315 0.0198,-0.02315 0.0132,-0.02315 0.0165,-0.02646 0.0132,-0.02646 0.0132,-0.02646 0.0132,-0.02646 0.003,-0.01323 0.01,-0.02646 0.0132,-0.04299 0.007,-0.02977 0.003,-0.02976 0.003,-0.02977 v -0.02977 -1.918229 c 0,-0.330729 -0.26789,-0.59862 -0.59862,-0.59862 h -3.800074 c -0.330729,0 -0.601927,0.267891 -0.601927,0.59862 z m -14.175052,-0.59862 c -0.330729,0 -0.59862,0.267891 -0.59862,0.59862 v 3.800078 c 0,0.330729 0.271198,0.601927 0.59862,0.601927 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 v -3.198151 h 2.599531 v 3.198151 c 0,0.330729 0.271198,0.601927 0.59862,0.601927 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 v -3.800078 c 0,-0.330729 -0.271198,-0.59862 -0.601927,-0.59862 z m 8.430286,0 H 89.33538 c -0.330729,0 -0.601927,0.267891 -0.601927,0.59862 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 0.783828 v 3.198151 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 0.327422,0 0.59862,-0.271198 0.59862,-0.601927 v -3.198151 h 0.783828 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 0,-0.330729 -0.271198,-0.59862 -0.601927,-0.59862 z m -14.085755,0 c -0.330729,0 -0.601927,0.267891 -0.601927,0.59862 v 3.800078 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 3.800078 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 v -3.800078 c 0,-0.330729 -0.271198,-0.59862 -0.601927,-0.59862 -0.330729,0 -0.601927,0.267891 -0.601927,0.59862 v 3.201458 h -2.596224 v -3.201458 c 0,-0.330729 -0.271198,-0.59862 -0.601927,-0.59862 z m -2.470547,1.200547 v 2.599531 H 72.94775 v -2.599531 z m -3.201458,-1.200547 c -0.330729,0 -0.59862,0.267891 -0.59862,0.59862 v 3.800078 c 0,0.330729 0.267891,0.601927 0.59862,0.601927 h 3.800078 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 v -3.800078 c 0,-0.330729 -0.271198,-0.59862 -0.601927,-0.59862 z m -4.831953,0 c -0.327422,0 -0.59862,0.267891 -0.59862,0.59862 v 3.800078 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 2.940182 c 0.33073,0 0.601927,-0.271198 0.601927,-0.601927 0,-0.330729 -0.271197,-0.59862 -0.601927,-0.59862 h -2.341562 v -2.599531 h 2.341562 c 0.33073,0 0.601927,-0.271198 0.601927,-0.601927 0,-0.330729 -0.271197,-0.59862 -0.601927,-0.59862 z m -6.264011,0.59862 v 1.931458 0.01323 l 0.0033,0.03307 0.0066,0.02646 0.0033,0.02976 0.0099,0.02977 0.0066,0.02977 0.0099,0.02646 0.01323,0.02646 0.01323,0.02646 0.01323,0.02646 0.01323,0.02315 0.01654,0.02646 0.01984,0.01984 0.01654,0.02315 0.01984,0.02315 0.01984,0.01984 0.02315,0.01984 0.01984,0.01654 0.02315,0.01984 0.02646,0.01654 0.02315,0.01323 0.02646,0.01323 0.02646,0.01323 0.02646,0.01323 0.02646,0.0099 0.02977,0.0066 0.02646,0.0099 0.02977,0.0033 0.02977,0.0066 0.02977,0.0033 h 0.02977 3.217994 v 0.701145 h -3.201458 c -0.327422,0 -0.59862,0.267891 -0.59862,0.59862 0,0.330729 0.271198,0.601927 0.59862,0.601927 h 3.803386 c 0.330729,0 0.598619,-0.271198 0.598619,-0.601927 V 13.10825 13.07849 l -0.0033,-0.02977 -0.0033,-0.02977 -0.0066,-0.02977 -0.0099,-0.02977 -0.01323,-0.03969 -0.01654,-0.043 L 66.18432,12.85026 66.17109,12.82711 66.15786,12.80065 66.14132,12.7775 66.12148,12.75435 66.10494,12.7312 66.0851,12.71136 66.06526,12.69152 66.04542,12.67168 66.02227,12.65184 65.99912,12.6353 65.97266,12.61876 65.94951,12.60222 65.92305,12.58899 65.8999,12.57576 l -0.02977,-0.0099 -0.02646,-0.0099 -0.02977,-0.0099 -0.02646,-0.0066 -0.02977,-0.0066 -0.02977,-0.0033 -0.02976,-0.0033 -0.02977,-0.0033 h -3.217995 v -0.697839 h 3.201459 c 0.330729,0 0.598619,-0.271198 0.598619,-0.601927 0,-0.330729 -0.271198,-0.59862 -0.598619,-0.59862 h -3.803386 c -0.327422,0 -0.59862,0.267891 -0.59862,0.59862 z m -1.27,-0.59862 c -0.327422,0 -0.598619,0.267891 -0.598619,0.59862 v 3.800078 c 0,0.330729 0.271197,0.601927 0.601927,0.601927 0.327422,0 0.598619,-0.271198 0.598619,-0.601927 v -3.800078 c 0,-0.330729 -0.271197,-0.59862 -0.601927,-0.59862 z m -5.089922,1.174089 h 1.316303 c 0.727604,0 1.326224,0.59862 1.326224,1.326224 0,0.727604 -0.59862,1.326224 -1.326224,1.326224 h -1.316303 v -1.332839 c 0,-0.03307 0,-0.06615 0,-0.09922 0,-0.383645 0,-0.763984 0,-1.14763 z m -1.174088,1.14763 v 0.07276 c 0,0.03307 0,0.06615 0,0.09922 v 0.07607 c 0,0.59862 0,1.19724 0,1.795859 v 0.03307 c 0,0.330729 0.267891,0.605235 0.59862,0.601927 h 1.891771 c 1.375833,0 2.500312,-1.124479 2.500312,-2.500312 0,-1.375834 -1.124479,-2.500313 -2.500312,-2.500313 h -1.891771 c -0.330729,-0.0033 -0.59862,0.271198 -0.59862,0.59862 v 0.03638 c 0,0.56224 0,1.124479 0,1.686719" style="fill:#dbc335;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path34"/><path d="m 45.209495,10.621252 c -0.330729,0 -0.601927,0.271198 -0.601927,0.601927 v 3.800078 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 2.599531 c 0.327422,0 0.59862,-0.271198 0.59862,-0.601927 0,-0.327422 -0.271198,-0.59862 -0.59862,-0.59862 h -2.000911 v -0.701145 h 2.000911 c 0.327422,0 0.59862,-0.271198 0.59862,-0.59862 0,-0.330729 -0.271198,-0.601927 -0.59862,-0.601927 h -2.000911 v -0.697839 h 2.000911 c 0.327422,0 0.59862,-0.271198 0.59862,-0.601927 0,-0.330729 -0.271198,-0.601927 -0.59862,-0.601927 z m 3.862916,0.601927 c 0,0.330729 0.271198,0.601927 0.59862,0.601927 h 0.787136 v 3.198151 c 0,0.330729 0.26789,0.601927 0.598619,0.601927 0.33073,0 0.601928,-0.271198 0.601928,-0.601927 v -3.198151 h 0.783828 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 0,-0.330729 -0.271198,-0.601927 -0.601927,-0.601927 h -2.771511 c -0.330729,0 -0.59862,0.271198 -0.59862,0.601927 z m -6.326849,0.601927 v 0.697839 h -2.599531 v -0.697839 z m -3.800078,-0.601927 v 3.800078 c 0,0.330729 0.267891,0.601927 0.59862,0.601927 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 v -1.299765 h 1.051719 l 1.723099,1.726406 c 0.234818,0.234818 0.618463,0.234818 0.849974,0 0.234818,-0.234818 0.234818,-0.615156 0,-0.849974 l -0.876432,-0.876432 h 0.466328 0.02976 l 0.02977,-0.0033 0.02977,-0.0033 0.02976,-0.0066 0.02977,-0.0066 0.04299,-0.01654 0.03969,-0.01654 0.02646,-0.0099 0.02315,-0.01654 0.02646,-0.01323 0.02315,-0.01654 0.02315,-0.01654 0.02315,-0.01984 0.02315,-0.01984 0.01984,-0.01984 0.02646,-0.03307 0.01984,-0.02315 0.02315,-0.03307 0.01654,-0.02646 0.01323,-0.02646 0.01323,-0.02315 0.0099,-0.02977 0.0099,-0.02646 0.0099,-0.02977 0.0066,-0.02646 0.0066,-0.02977 0.0066,-0.02976 0.0033,-0.02977 v -0.02977 -1.918229 c 0,-0.330729 -0.271198,-0.601927 -0.601927,-0.601927 h -3.800078 c -0.330729,0 -0.59862,0.271198 -0.59862,0.601927 z m -4.206875,-0.601927 c -0.330729,0 -0.601927,0.271198 -0.601927,0.601927 v 3.800078 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 2.940183 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 0,-0.327422 -0.271198,-0.59862 -0.601927,-0.59862 h -2.341563 v -2.599531 h 2.341563 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 0,-0.330729 -0.271198,-0.601927 -0.601927,-0.601927 z m -4.471458,0 c -0.330729,0 -0.601927,0.271198 -0.601927,0.601927 v 3.800078 c 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 2.599531 c 0.327422,0 0.59862,-0.271198 0.59862,-0.601927 0,-0.327422 -0.271198,-0.59862 -0.59862,-0.59862 h -2.000911 v -0.701145 h 2.000911 c 0.327422,0 0.59862,-0.271198 0.59862,-0.59862 0,-0.330729 -0.271198,-0.601927 -0.59862,-0.601927 h -2.000911 v -0.697839 h 2.000911 c 0.327422,0 0.59862,-0.271198 0.59862,-0.601927 0,-0.330729 -0.271198,-0.601927 -0.59862,-0.601927 z m -6.270625,0.601927 v 1.914922 l 0.0033,0.02977 0.0033,0.03307 v 0.01323 l 0.0066,0.02976 0.0066,0.02977 0.0099,0.02646 0.0066,0.02977 0.01654,0.03969 0.01323,0.02646 0.01323,0.02646 0.01654,0.02315 0.01654,0.02315 0.01654,0.02646 0.01984,0.01984 0.01654,0.02315 0.02315,0.01984 0.01984,0.01984 0.03307,0.02646 0.02315,0.01654 0.02646,0.01654 0.02646,0.01323 0.02315,0.01323 0.02646,0.01323 0.02646,0.0099 0.02976,0.0099 0.043,0.01323 0.02977,0.0066 0.02977,0.0033 0.02977,0.0033 h 0.02977 3.217994 v 0.701145 h -3.201458 c -0.330729,0 -0.601927,0.267891 -0.601927,0.59862 0,0.330729 0.271198,0.601927 0.601927,0.601927 h 3.800078 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 v -1.914922 l -0.0033,-0.02976 -0.0033,-0.02977 -0.0033,-0.02977 -0.0066,-0.02977 -0.0066,-0.02977 -0.0066,-0.02646 -0.01323,-0.02646 -0.0099,-0.02977 -0.01323,-0.02646 -0.01323,-0.02315 -0.01654,-0.02646 -0.01654,-0.02315 -0.01654,-0.02315 -0.02646,-0.03307 -0.01984,-0.01984 -0.01984,-0.01984 -0.02315,-0.01984 -0.02315,-0.01984 -0.03638,-0.02315 -0.02315,-0.01654 -0.02646,-0.01323 -0.02646,-0.01323 -0.02646,-0.0099 -0.02646,-0.0099 -0.02977,-0.0099 -0.02646,-0.0066 -0.02977,-0.0066 -0.02977,-0.0033 -0.03307,-0.0033 -0.02976,-0.0033 h -3.214688 v -0.697839 h 3.198151 c 0.330729,0 0.601927,-0.271198 0.601927,-0.601927 0,-0.330729 -0.271198,-0.601927 -0.601927,-0.601927 h -3.800078 c -0.330729,0 -0.601927,0.271198 -0.601927,0.601927" style="fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path36"/><path d="m 14.894529,9.242112 h 2.798299 c 2.133203,0 3.879453,1.746249 3.879453,3.88276 0,2.133203 -1.74625,3.879453 -3.879453,3.879453 h -2.798299 -0.02646 -6.61e-4 -0.02547 -6.62e-4 c -0.559263,0 -1.016992,-0.456406 -1.016992,-1.015339 v -2.450703 h 2.929268 c 0.162058,0.363802 0.522552,0.615157 0.945886,0.615157 0.568854,0 1.028567,-0.459714 1.028567,-1.028568 0,-0.568854 -0.459713,-1.031875 -1.028567,-1.031875 -0.423334,0 -0.783828,0.254661 -0.945886,0.615156 h -2.929268 v -2.447396 c 0,-0.558932 0.457729,-1.018645 1.016992,-1.018645 h 6.62e-4 0.02547 6.61e-4 0.02646" style="fill:#dbc335;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path38"/><path d="m 5.5712741,13.124872 v -2.864115 c 0,-0.558932 0.457729,-1.018645 1.016992,-1.018645 h 5.7282289 c 0.559263,0 1.016992,0.459713 1.016992,1.018645 v 0 c 0,0.558933 -0.457729,1.015339 -1.016992,1.015339 H 9.5807031 c -0.159742,-0.360495 -0.522221,-0.615156 -0.944232,-0.615156 -0.569515,0 -1.031213,0.46302 -1.031213,1.031875 0,0.568854 0.461698,1.028567 1.031213,1.028567 0.422011,0 0.78449,-0.251354 0.944232,-0.615156 h 2.7357919 v 0 h 0.02613 v 0 l 0.02613,0.0033 v 0 h 0.0258 v 0 l 0.0258,0.0033 v 0 l 0.02514,0.0033 v 0 l 0.02547,0.0033 v 0 l 0.02514,0.0033 v 0 l 0.0248,0.0033 v 0 l 0.02481,0.0066 v 0 l 0.02414,0.0066 v 0 l 0.02414,0.0066 v 0 l 0.02414,0.0066 v 0 l 0.02348,0.0066 v 0 l 0.02381,0.0099 v 0 l 0.02282,0.0066 v 0.0033 l 0.02282,0.0066 v 0.0033 l 0.02315,0.0066 v 0 l 0.02216,0.01323 v 0 l 0.02216,0.0099 v 0 l 0.02183,0.0099 v 0.0033 l 0.0215,0.0099 v 0 l 0.02084,0.01323 v 0 l 0.02117,0.01323 v 0 l 0.02017,0.01323 v 0 l 0.02017,0.01323 v 0 l 0.01984,0.01323 v 0 l 0.01918,0.01654 v 0 l 0.01951,0.01654 v 0 l 0.01852,0.01323 v 0 l 0.01819,0.01654 v 0 l 0.01786,0.01654 v 0 l 0.01753,0.01654 v 0.0033 l 0.0172,0.01654 v 0 l 0.01654,0.01654 v 0 l 0.01621,0.01984 v 0 l 0.01587,0.01654 v 0 l 0.01521,0.01984 v 0 l 0.01521,0.01984 v 0 l 0.01422,0.01984 v 0 l 0.01356,0.01984 v 0 l 0.01389,0.01984 v 0 l 0.0129,0.02315 v 0 l 0.01257,0.01984 v 0 l 0.01191,0.01984 v 0 l 0.01191,0.02315 v 0 l 0.01091,0.02315 v 0 l 0.01058,0.01984 v 0 l 0.0099,0.02315 v 0 l 0.0093,0.02315 v 0 l 0.0089,0.02315 v 0 l 0.0083,0.02315 v 0 l 0.0076,0.02315 v 0 l 0.0073,0.02646 v 0 l 0.0066,0.02315 v 0 l 0.006,0.02315 v 0 l 0.0053,0.02646 v 0 l 0.005,0.02315 v 0 l 0.0043,0.02646 v 0 l 0.0033,0.02646 v 0 l 0.003,0.02315 v 0 l 0.0023,0.02646 v 0 l 0.0016,0.02646 v 0 l 10e-4,0.02646 v 0 l 3.18e-4,0.02646 v 2.864114 c 0,0.558933 -0.457729,1.015339 -1.016992,1.015339 H 6.5882661 c -0.559263,0 -1.016992,-0.456406 -1.016992,-1.015339 v 0 c 0,-0.562239 0.457729,-1.018645 1.016992,-1.018645 h 2.731823 c 0.154781,0.373724 0.523213,0.638307 0.9531609,0.638307 0.569185,0 1.031214,-0.463021 1.031214,-1.031875 0,-0.568854 -0.462029,-1.031875 -1.031214,-1.031875 -0.4137419,0 -0.7702679,0.244739 -0.9349709,0.595312 h -2.750013 v 0 h -0.0258 v 0 h -0.02613 v 0 l -0.02613,-0.0033 v 0 h -0.02547 v 0 l -0.02547,-0.0033 v 0 l -0.02547,-0.0033 v 0 l -0.02514,-0.0066 v 0 l -0.02481,-0.0033 v 0 l -0.02481,-0.0066 v 0 l -0.02414,-0.0066 v 0 l -0.02414,-0.0033 v -0.0033 l -0.02414,-0.0066 v 0 l -0.02348,-0.0066 v 0 l -0.02348,-0.0066 v -0.0033 l -0.02315,-0.0066 v 0 l -0.02282,-0.0099 v 0 l -0.02282,-0.0099 v 0 l -0.02249,-0.0099 v 0 l -0.02216,-0.0099 v -0.0033 l -0.02183,-0.0099 v 0 l -0.0215,-0.01323 v 0 l -0.02084,-0.0099 v 0 l -0.02117,-0.01324 v 0 l -0.02017,-0.01323 v -0.0033 l -0.01984,-0.01323 v 0 l -0.02018,-0.01323 v 0 l -0.01918,-0.01323 v -0.0033 l -0.01951,-0.01323 v 0 l -0.01852,-0.01654 v 0 l -0.01819,-0.01654 v 0 l -0.01786,-0.01654 v 0 l -0.01753,-0.01654 v 0 l -0.0172,-0.01654 v 0 l -0.01654,-0.01984 v 0 l -0.01587,-0.01654 v 0 l -0.01621,-0.01984 v 0 l -0.01521,-0.01984 v 0 l -0.01488,-0.01984 v 0 l -0.01455,-0.01984 v 0 l -0.01356,-0.01984 v 0 l -0.01389,-0.01984 v 0 l -0.0129,-0.01984 v 0 l -0.01257,-0.01984 v -0.0033 l -0.01191,-0.01984 v 0 l -0.01157,-0.01984 v -0.0033 l -0.01125,-0.01984 v 0 l -0.01025,-0.02315 v 0 l -0.0099,-0.02315 v 0 l -0.0096,-0.02315 v 0 l -0.0089,-0.02315 v 0 l -0.0079,-0.02315 v 0 l -0.0079,-0.02315 v 0 l -0.0073,-0.02315 v 0 l -0.0066,-0.02646 v 0 l -0.0056,-0.02315 v 0 l -0.0056,-0.02315 v -0.0033 l -0.005,-0.02315 v 0 l -0.0043,-0.02646 v 0 l -0.0033,-0.02315 v 0 l -0.003,-0.02646 v 0 l -0.0023,-0.02646 v 0 l -0.0016,-0.02315 v -0.0033 l -9.92e-4,-0.02315 v 0 l -3.31e-4,-0.02646" style="fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path40"/></g></svg>';

 var searchFormImage = '<svg xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;margin-right:5px;" width="35" height="20" viewBox="0 0 78.09568 37.885021" version="1.1" id="svg58"> <defs id="defs52"/> <g id="layer1" transform="translate(-0.02752488,0.01081357)"> <path d="m 45.533155,-0.01081357 h 13.64919 c 10.42127,0 18.94086,8.51957997 18.94086,18.94416057 0,10.42128 -8.51959,18.94086 -18.94086,18.94086 h -13.64919 -0.1323 -0.003 -0.12237 -0.003 c -2.72851,0 -4.96424,-2.23573 -4.96424,-4.96424 v -11.95256 h 14.30073 c 0.77721,1.76941 2.54992,3.00633 4.60706,3.00633 2.77812,0 5.03369,-2.25226 5.03369,-5.03039 0,-2.78143 -2.25557,-5.0337 -5.03369,-5.0337 -2.05714,0 -3.82985,1.23693 -4.60706,3.00633 H 40.308225 V 4.9534264 c 0,-2.72852 2.23573,-4.96423997 4.96425,-4.96423997 h 0.003 l 0.12237,0.003 h 0.003 l 0.13231,-0.003" style="fill:#dbc335;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path26"/> <path d="M 0.02812488,18.933347 V 4.9534264 c 0,-2.73182 2.23242002,-4.96423997 4.96424002,-4.96423997 H 32.948905 c 2.72852,0 4.96425,2.23241997 4.96425,4.96423997 v 0 c 0,2.73182 -2.23573,4.9642399 -4.96425,4.9642399 h -13.35154 c -0.78052,-1.7693999 -2.54992,-3.0063199 -4.61036,-3.0063199 -2.77813,0 -5.0303898,2.25226 -5.0303898,5.0303906 0,2.78143 2.2522598,5.0337 5.0303898,5.0337 2.06044,0 3.82984,-1.23693 4.61036,-3.00964 h 13.35154 v 0.003 h 0.12899 v 0 l 0.12567,0.003 v 0.003 l 0.12568,0.007 v 0 l 0.12568,0.01 v 0.003 l 0.12567,0.01 v 0.003 l 0.12237,0.0165 v 0 l 0.12237,0.0198 v 0 l 0.12237,0.0232 v 0 l 0.11907,0.0265 v 0 l 0.11906,0.0298 v 0 l 0.11906,0.0331 v 0 l 0.11576,0.0331 v 0.003 l 0.11575,0.0364 v 0 l 0.11576,0.0397 v 0 l 0.11244,0.043 v 0 l 0.11245,0.0463 v 0 l 0.10914,0.0463 v 0.003 l 0.10914,0.0496 v 0 l 0.10914,0.0529 v 0.003 l 0.10584,0.0529 v 0.003 l 0.10252,0.0562 v 0 l 0.10584,0.0595 v 0.003 l 0.10252,0.0628 v 0 l 0.0992,0.0662 v 0 l 0.0959,0.0661 v 0 l 0.0992,0.0728 v 0 l 0.0926,0.0728 v 0 l 0.0926,0.0728 v 0.003 l 0.0926,0.0761 v 0 l 0.0893,0.0761 v 0.003 l 0.086,0.0794 v 0 l 0.086,0.0827 v 0.003 l 0.0827,0.0827 v 0 l 0.0827,0.086 v 0.003 l 0.0794,0.086 v 0.003 l 0.0761,0.0893 v 0 l 0.0761,0.0926 v 0.003 l 0.0728,0.0926 v 0 l 0.0694,0.0959 v 0 l 0.0661,0.0992 v 0 l 0.0661,0.0992 v 0 l 0.0661,0.10253 v 0 l 0.0595,0.10252 v 0 l 0.0595,0.10253 v 0.003 l 0.0562,0.10252 v 0.003 l 0.0529,0.10584 v 0 l 0.0529,0.10914 v 0.003 l 0.0463,0.10914 v 0 l 0.0496,0.10914 v 0.003 l 0.043,0.10914 v 0.003 l 0.0397,0.11245 v 0.003 l 0.0364,0.11245 v 0 l 0.0364,0.11906 v 0 l 0.0298,0.11575 v 0.003 l 0.0298,0.11576 v 0.003 l 0.0265,0.11906 v 0 l 0.0231,0.11906 v 0.003 l 0.0231,0.12237 v 0 l 0.0165,0.12237 v 0 l 0.0132,0.12237 v 0 l 0.01,0.12568 v 0 l 0.01,0.12568 v 0.003 l 0.003,0.12567 v 0 l 0.003,0.12568 v 13.97992 c 0,2.73183 -2.23573,4.96425 -4.96424,4.96425 H 4.9917649 c -2.73182,2.2e-4 -4.96424002,-2.2322 -4.96424002,-4.96402 v 0 c 0,-2.73183 2.23242002,-4.96425 4.96424002,-4.96425 H 18.323465 c 0.75737,1.82563 2.55323,3.10886 4.65336,3.10886 2.77812,0 5.03039,-2.25227 5.03039,-5.0337 0,-2.77813 -2.25227,-5.03039 -5.03039,-5.03039 -2.02076,0 -3.76039,1.19062 -4.56407,2.90711 H 4.9917649 v -0.003 h -0.12898 v 0 l -0.12568,-0.003 v -0.003 l -0.12567,-0.007 v 0 l -0.12568,-0.01 v -0.003 l -0.12568,-0.01 v -0.003 l -0.12237,-0.0166 v 0 l -0.12237,-0.0198 v 0 l -0.12237,-0.0232 v 0 l -0.11906,-0.0265 v 0 l -0.11906,-0.0298 v 0 l -0.11907,-0.0331 v 0 l -0.11575,-0.0331 v -0.003 l -0.11576,-0.0364 v 0 l -0.11575,-0.0397 v 0 l -0.11245,-0.043 v 0 l -0.11245,-0.0463 v 0 l -0.10914,-0.0463 v -0.003 l -0.10914,-0.0496 v 0 l -0.10914,-0.0529 v 0 l -0.10583,-0.0562 v -0.003 l -0.10584,-0.0562 v 0 l -0.10252,-0.0595 v -0.003 l -0.10253,-0.0628 v 0 l -0.0992,-0.0661 v 0 l -0.0959,-0.0662 v 0 l -0.0992,-0.0695 v -0.003 l -0.0926,-0.0728 v 0 l -0.0926,-0.0728 v -0.003 l -0.0926,-0.0761 v 0 l -0.0893,-0.0761 v -0.003 l -0.086,-0.0794 v 0 l -0.086,-0.0827 v -0.003 l -0.0827,-0.0827 v 0 l -0.0827,-0.086 v -0.003 l -0.0794,-0.086 v -0.003 l -0.0761,-0.0893 v 0 l -0.0761,-0.0926 v -0.003 l -0.0728,-0.0926 v 0 l -0.0694,-0.0959 v 0 l -0.0661,-0.0992 v 0 l -0.0661,-0.0992 v 0 l -0.0661,-0.10253 v 0 l -0.0595,-0.0992 v -0.003 l -0.0595,-0.10253 v -0.003 l -0.0562,-0.10252 v -0.003 l -0.0529,-0.10584 v 0 l -0.0529,-0.10914 v 0 l -0.0463,-0.11248 v 0 l -0.0496,-0.10914 v -0.003 l -0.0397,-0.10914 v -0.003 l -0.043,-0.11245 v -0.003 l -0.0364,-0.11245 v 0 l -0.0364,-0.11906 v 0 l -0.0298,-0.11578 v -0.003 l -0.0298,-0.11576 v -0.003 l -0.0265,-0.11906 v 0 l -0.0232,-0.11908 v -0.003 l -0.0231,-0.12237 v 0 l -0.0165,-0.12237 v 0 l -0.0132,-0.12237 v 0 l -0.01,-0.12568 v 0 l -0.01,-0.12568 v -0.003 l -0.003,-0.12568 v 0 l -0.003,-0.12568" style="fill:#040307;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path28"/></g></svg>';
 var logoImageWhite = '<svg xmlns="http://www.w3.org/2000/svg" class="cd-logo_small" width="35" height="20" viewBox="0 0 78.095077 37.885025" version="1.1" id="svg3775"><defs id="defs3769" /><g id="layer1" transform="translate(67.419495,10.624447)"><path d="m -21.917776,-10.624447 h 13.6525 c 10.421276,0 18.940859,8.5195826 18.940859,18.9441666 0,10.4212764 -8.519583,18.9408594 -18.940859,18.9408594 h -13.6525 -0.128985 -0.0033 -0.12237 -0.0033 c -2.728516,0 -4.964245,-2.235729 -4.964245,-4.964245 V 10.343782 h 14.297422 c 0.780521,1.769401 2.553229,3.006328 4.610365,3.006328 2.778125,0 5.033698,-2.252265 5.033698,-5.0303904 0,-2.781433 -2.255573,-5.033698 -5.033698,-5.033698 -2.057136,0 -3.829844,1.236927 -4.607058,3.006328 H -27.13999 v -11.952552 c 0,-2.728516 2.235729,-4.9642446 4.964245,-4.9642446 h 0.0033 l 0.12237,0.0033 h 0.0033 l 0.128985,-0.0033" style="fill:#dbc335;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path18"/><path d="m -67.419495,8.3197196 v -13.979922 c 0,-2.731823 2.233745,-4.9642446 4.964245,-4.9642446 h 27.956536 c 2.728516,0 4.964245,2.2324216 4.964245,4.9642446 v 0 c 0,2.731823 -2.235729,4.96424498 -4.964245,4.96424498 h -13.354843 c -0.777214,-1.76940098 -2.546615,-3.00632898 -4.607058,-3.00632898 -2.778125,0 -5.03039,2.252266 -5.03039,5.030391 0,2.781432 2.252265,5.033698 5.03039,5.033698 2.060443,0 3.829844,-1.236927 4.610365,-3.009635 h 13.351536 v 0.0033 h 0.128985 v 0 l 0.125677,0.0033 v 0.0033 l 0.125677,0.0066 v 0 l 0.125677,0.0099 v 0.0033 l 0.12237,0.0099 v 0.0033 l 0.125677,0.01654 v 0 l 0.12237,0.01984 v 0 l 0.122369,0.02315 v 0 l 0.119063,0.02646 v 0 l 0.119062,0.02977 v 0 l 0.119063,0.03307 v 0 l 0.115755,0.03307 v 0.0033 l 0.115755,0.03638 v 0 l 0.115756,0.03969 v 0 l 0.112447,0.043 v 0 l 0.109141,0.0463 v 0 l 0.112448,0.0463 v 0.0033 l 0.109141,0.04961 v 0 l 0.10914,0.05292 v 0.0033 l 0.105834,0.05292 v 0.0033 l 0.102526,0.05622 v 0 l 0.105833,0.05953 v 0.0033 l 0.09922,0.06284 v 0 l 0.09922,0.06615 v 0 l 0.09922,0.06615 v 0 l 0.09922,0.07276 v 0 l 0.0926,0.07276 v 0 l 0.0926,0.07276 v 0.0033 l 0.0926,0.07607 v 0 l 0.0893,0.07607 v 0.0033 l 0.08599,0.07938 v 0 l 0.08599,0.08268 v 0.0033 l 0.08268,0.08268 v 0 l 0.08268,0.08599 v 0.0033 l 0.07607,0.08599 v 0.0033 l 0.07938,0.0893 v 0 l 0.07607,0.0926 v 0.0033 l 0.07276,0.0926 v 0 l 0.06945,0.09591 v 0 l 0.06615,0.09922 v 0 l 0.06615,0.09922 v 0 l 0.06615,0.102526 v 0 l 0.05953,0.102526 v 0 l 0.05953,0.102526 v 0.0033 l 0.05622,0.102526 v 0.0033 l 0.05292,0.105833 v 0 l 0.05292,0.109141 v 0.0033 l 0.0463,0.109141 v 0 l 0.0463,0.10914 v 0.0033 l 0.04299,0.10914 v 0.0033 l 0.03969,0.112448 v 0.0033 l 0.03969,0.112448 v 0 l 0.03307,0.119062 v 0 l 0.03307,0.115755 v 0.0033 l 0.02977,0.115755 v 0.0033 l 0.02646,0.119063 v 0 l 0.02315,0.119062 v 0.0033 l 0.01984,0.12237 v 0 l 0.01984,0.12237 v 0 l 0.01323,0.12237 v 0 l 0.0099,0.125677 v 0 l 0.0099,0.125677 v 0.0033 l 0.0033,0.125677 v 0 l 0.0033,0.125677 V 22.2961 c 0,2.731823 -2.235729,4.964245 -4.964245,4.964245 H -62.45525 c -2.7305,0 -4.964245,-2.232422 -4.964245,-4.964245 v 0 c 0,-2.731823 2.233745,-4.964245 4.964245,-4.964245 h 13.331693 c 0.757369,1.825625 2.553229,3.108855 4.653359,3.108855 2.778125,0 5.030391,-2.252266 5.030391,-5.033698 0,-2.778125 -2.252266,-5.030391 -5.030391,-5.030391 -2.020755,0 -3.760391,1.190625 -4.564063,2.907109 H -62.45525 v -0.0033 h -0.128984 v 0 l -0.125678,-0.0033 v -0.0033 l -0.125677,-0.0066 v 0 l -0.125677,-0.0099 v -0.0033 l -0.125677,-0.0099 v -0.0033 l -0.12237,-0.01654 v 0 l -0.122369,-0.01984 v 0 l -0.12237,-0.02315 v 0 l -0.119063,-0.02646 v 0 l -0.119062,-0.02977 v 0 L -63.810578,13.092 v 0 l -0.117078,-0.03307 v -0.0033 l -0.115094,-0.03625 v 0 l -0.115094,-0.03969 v 0 l -0.112778,-0.04299 v 0 l -0.111787,-0.0463 v 0 l -0.111125,-0.0463 v -0.0033 l -0.10881,-0.04961 v 0 l -0.10881,-0.05293 v 0 l -0.105502,-0.05622 v -0.0033 l -0.104511,-0.05622 v 0 l -0.102856,-0.05953 v -0.0033 l -0.102527,-0.06284 v 0 l -0.09922,-0.06615 v 0 l -0.0979,-0.06615 v 0 l -0.0969,-0.06945 v -0.0033 l -0.09459,-0.07276 v 0 l -0.0936,-0.07276 v -0.0033 l -0.09095,-0.07607 v 0 l -0.08897,-0.07607 v -0.0033 l -0.08764,-0.07937 v 0 l -0.08467,-0.08268 v -0.0033 l -0.084,-0.08268 v 0 l -0.0807,-0.08599 v -0.0033 l -0.07904,-0.08599 v -0.0033 l -0.07706,-0.0893 v 0 l -0.07541,-0.09261 v -0.0033 l -0.07276,-0.0926 v 0 l -0.07045,-0.09591 v 0 l -0.06747,-0.09922 v 0 l -0.06615,-0.09922 v 0 l -0.06416,-0.102526 v 0 l -0.06119,-0.09922 v -0.0033 l -0.05788,-0.102526 v -0.0033 l -0.05722,-0.102526 v -0.0033 L -66.9277,10.46624 v 0 l -0.05159,-0.109229 v 0 l -0.04763,-0.112448 v 0 l -0.04729,-0.10914 v -0.0033 l -0.043,-0.10914 v -0.0033 L -67.1569,9.9072346 v -0.0033 l -0.03803,-0.112448 v 0 l -0.03506,-0.119062 v 0 l -0.03241,-0.115755 v -0.0033 l -0.0291,-0.115755 v -0.0033 l -0.02613,-0.119063 v 0 l -0.02414,-0.119062 v -0.0033 l -0.0205,-0.12237 v 0 l -0.01654,-0.12237 v 0 l -0.01455,-0.12237 v 0 l -0.01091,-0.125677 v 0 l -0.0083,-0.125677 v -0.0033 l -0.0056,-0.125677 v 0 l -0.0013,-0.125677" style="fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.03307291" id="path20"/></g></svg>';

var siteUrl = 'https://secretdiscounter.ru/';
//var siteUrl = 'http://sdyii/';
var storesUrl = 'stores/data';
var userUrl = 'account/notification';
var storageDataKeyStores = 'secretdiscounter_local_stores';
var storageDataKeyDate = 'secretdiscounter_local_date';
var usersData = false;
var storageDataStores = false;
var storageDataDate = false;
var isOpera = navigator.userAgent.indexOf(' OPR/') >= 0;
var appIds = {
    'chrome': {
        'id': 'sd_chrome_app',
        //'used': !!window.chrome && !!window.chrome.webstore
        //'used': window.chrome !== null && window.chrome.webstore !== null && !isOpera,
        'search_delay': 0
    },
    'firefox': {
        'id': 'sd_firefox_app',
        //'used':  typeof InstallTrigger !== 'undefined',
        'search_delay': 0
    },
    'opera': {
        'id': 'sd_opera_app',
        //'used': isOpera,
        'search_delay': 100
    }
};
var currentBrowser = 'chrome';
if (navigator.userAgent.indexOf(' OPR/') >= 0) {
    currentBrowser = 'opera';
} else if (!!window.chrome && !!window.chrome.webstore) {
    currentBrowser = 'chrome';
} else if (typeof InstallTrigger !== 'undefined') {
    currentBrowser = 'firefox';
}




function Storage(){}

Storage.configure = function(details) {
    if (!chrome || !chrome.storage) {
        throw new Error("The chrome.storage object is not available.");
    }
    if (Storage._configured || Storage._loadingFlag || Storage._loaded) {
        throw new Error("Storage can only be configured once and must be configured before the load method is called.");
    }
    Storage._configured = true;
    var scope = details.scope;
    if (scope) {
        if (!/^(sync|local)$/.test(scope)) {
            throw new Error("Invalid scope. Must be \"local\" or \"sync\"");
        }
        Storage._scope = scope;
    }
};

Storage.load = function(callback) {
    if (callback) {
        Storage._loadingQue.push(callback);
    }
    if (Storage._loadingFlag) {
        return;
    }
    Storage._loadingFlag = true;
    Storage._do("get", [null, function(e) {
        Storage._snapshot = e;
        Storage._loadingFlag = false;
        Storage._loaded = true;
        for (var i in Storage._loadingQue) {
            Storage._loadingQue[i](e);
        }
        Storage._loadingQue = [];
        chrome.storage.onChanged.addListener(Storage._onChanged);
    }]);
};

Storage._snapshot = {};
Storage._scope = "local";
Storage._loaded = false;
Storage._loadingFlag = false;
Storage._loadingQue = [];
Storage._configured = false;
Storage._debounceQue = [];
Storage._debounceTimer = null;

Storage._onChanged = function(properties, scope) {
    if (scope !== Storage._scope) {
        return;
    }
    for (var i in properties) {
        Storage._snapshot[i] = properties[i].newValue;
    }
};

Storage._do = function(method, args) {
    Storage._debounceMethod(function() {
        chrome.storage[Storage._scope][method].apply(chrome.storage[Storage._scope], args);
    });
};

Storage._debounceMethod = function(method) {
    Storage._debounceQue.push(method);
    Storage._debounceTimer = clearTimeout(Storage._debounceTimer);
    Storage._debounceTimer = setTimeout(Storage._onDebounceTimer.bind(Storage));
};

Storage._onDebounceTimer = function() {
    var copy = [];
    for (var i in Storage._debounceQue) {
        copy.push(Storage._debounceQue[i]);
    }
    Storage._debounceQue = [];
    Storage._debounceTimer = null;
    for (var i in copy) {
        copy[i]();
    }
};

Storage.get = function(key, defaultValue) {
    if (!Storage._loaded) {
        throw new Error("Storage.load must be called before you can access this method.");
    }
    if (key === undefined || key === null) {
        return Storage._snapshot;
    }
    else if (typeof(key) === "object") {
        var obj = {};
        if (key.constructor === Array) {
            for (var i in key) {
                obj[key[i]] = true;
            }
        }
        else {
            for (var i in key) {
                obj[i] = true;
            }
        }
        for (var i in obj) {
            obj[i] = Storage._snapshot[i];
        }
        return obj;
    }
    else {
        var value = Storage._snapshot[key];
        return value === undefined ? defaultValue : value;
    }
};

Storage.set = function(key, value, callback) {
    if (!Storage._loaded) {
        throw new Error("Storage.load must be called before you can access this method.");
    }
    var obj = {};
    if (typeof(key) === "object") {
        obj = key;
        callback = value;
    }
    else {
        obj[key] = value;
    }
    var removes = {};
    var sets = {};
    var hasRemoves = false;
    var hasSets = false;
    for (var i in obj) {
        if (obj[i] === undefined || obj[i] === null) {
            removes[i] = obj[i];
            hasRemoves = true;
            delete Storage._local[i];

        }
        else {
            sets[i] = obj[i];
            hasSets = true;
            Storage._snapshot[i] = obj[i];
        }
    }
    if (hasRemoves) {
        Storage._do("remove", [removes]);
    }
    if (hasSets) {
        Storage._do("set", [sets, callback]);
    }
    else if (callback) {
        callback();
    }
};

Storage.remove = function(key) {
    if (!Storage._loaded) {
        throw new Error("Storage.load must be called before you can access this method.");
    }
    var keys = typeof(key) === "object" ? key : [key];
    var obj = {};
    for (var i in keys) {
        obj[keys[i]] = undefined;
    }
    Storage.set(obj);
};

Storage.clear = function(callback) {
    if (!Storage._loaded) {
        throw new Error("Storage.load must be called before you can access this method.");
    }
    Storage._snapshot = {};
    Storage._do("clear", [callback]);
};

    function ucfirst(str) {   // Make a string&#039;s first character uppercase
        var f = str.charAt(0).toUpperCase();
        return f + str.substr(1, str.length - 1);
    }

    function closeClick() {
        document.querySelector('.secretdiscounter-extension').style.display = 'none';
    }

    function getRequest(url, dataKey, callback){
        //вызываем событие для запроса из background.js
        //console.log('получаем данные', url, dataKey);
        chrome.runtime.sendMessage({
            action: 'xhttp',
            url: siteUrl + url
        }, function (responseData) {

            //console.log(responseData);
                // set a storage key
            Storage.set(dataKey, responseData, callback);
        });
    }

    function getUsers(){
        console.log('getusers');
        chrome.runtime.sendMessage({
            action: 'xhttp',
            url: siteUrl + userUrl
        }, function (responseData) {
            console.log('getusers success', responseData);
            usersData = responseData;

        });
    }


    function getData() {
        //console.log('get data');
        getRequest(storesUrl, storageDataKeyStores);
        // getRequest(storesUrl, storageDataKeyStores, function(){
        //     setTimeout(function(){
        //         console.log('после таймаута');
        //         findShop();
        //     }, 2000);
        // });
        //getRequest(userUrl, storageDataKeyUsers, null);
        Storage.set(storageDataKeyDate, new Date().getTime());
    }

    function makeCashback(displayedCashback, currency, action){
        var cashbackNum = parseFloat(displayedCashback.replace(/[^\d.]+/g,""));
        var result = '';
        if (action == 1) {
            cashbackNum = cashbackNum * 2;
        }
        if (!cashbackNum) {
            result = '10%';
        } else {
            result = displayedCashback.replace(/[\d.]+/, cashbackNum) +
                (displayedCashback.match(/\%/) ? "" : " " + currency);
        }
        return result;
    }

    function replaceTemplate(items, template){
        items = items || {};
        for (var key in items) {
            template = template.replace('{{'+key+'}}', items[key]);
        }
        return template;
    }

    function findShop() {
        //console.log('функция поиска шопов');
        if (storageDataStores == null || storageDataStores.length == 0) {
            return null;
        }
        //найти магазин, если на нем находимся
        //console.log('сам поиск шопов');

        var here = (window.location.host).replace('www.', '');
        var url;
        var div = null;
        storageDataStores.stores.forEach(function (item) {

            currentUrl = item.url.split('//')[1].replace('www.', '').split('/')[0];
            //console.log(item.url, currentUrl, here);

            if ((here == currentUrl || here.indexOf(currentUrl) > -1) && !div) {
                //нашли, мы находимся здесь
                //console.log('here', item);
                var url = '';
                if (usersData && usersData.user) {
                    url = siteUrl + 'goto/store:' + item.uid;
                } else {
                    url = siteUrl + 'stores/' + item.store_route+'#login';
                }
                var closeDiv = document.createElement('div');
                closeDiv.innerHTML = '<div class="secretdiscounter-extension__button_icon">&times;</div>';
                closeDiv.className = 'secretdiscounter-extension__button_close';
                closeDiv.onclick = closeClick;
                currentUrl = currentUrl.split('/')[0];
                var message = replaceTemplate({
                    'cashback': makeCashback(item.displayed_cashback, item.currency, item.action_id),
                    'currentUrl': siteUrl+item.url,
                    'storename': ucfirst(item.name)
                }, storageDataStores.text);
                var text = '<a href="' + siteUrl + '#login" class="cd-logo" target="_blank">'+
                    // "<img class='cd-logo_big' src='" + logoImage + "' width='170' alt='secretdiscounter logo'>"+
                    // "<img class='cd-logo_small' src='" + logoImageWhite + "' width='32' alt='sd logo'>"+
                    logoImage+logoImageWhite+
                    '</a>' +
                    '<div class="secretdiscounter-extension__text">' + message + '</div>' +
                    '<a class="secretdiscounter-extension__link" href="' + url + '" target="_blank">Получить&nbsp;кэшбэк</a>';
                div = document.createElement('div');
                div.className = 'secretdiscounter-extension';
                div.innerHTML = text;
                div.appendChild(closeDiv);

                document.body.insertBefore(div, document.body.firstChild);
                return false;
            }
        });

    }

    //изменение поиска
    function checkSearch(searchString, engine) {
        if (storageDataStores == null || storageDataStores.stores.length == 0) {
            return null;
        }
        var div = document.createElement('div');
        var message = false;
        storageDataStores.stores.forEach(function (item) {
            //проверка, что строка поиска включена в название или урл магазина
            if ((item.name.toUpperCase().indexOf(searchString) >= 0 || item.url.toUpperCase().indexOf(searchString) >= 0)&& !message) {
                console.log(item, usersData);
                message = replaceTemplate({
                    'cashback': makeCashback(item.displayed_cashback, item.currency, item.action_id),
                    'currentUrl': siteUrl + item.url,
                    'storename': ucfirst(item.name)
                }, storageDataStores.searchtext);
                var url = '';
                if (usersData && usersData.user) {
                    url = siteUrl + 'goto/store:' + item.uid;
                } else {
                    url = siteUrl + 'stores/' + item.store_route+'#login';
                }
                div.innerHTML = "<a href='" + url+"'target='_blank'>"+
                    // "<span style='margin-right:5px;height:18px;vertical-align:middle'>"+searchFormImage+"</span>"+message;
                    searchFormImage+message;
                div.id = 'secretdiscounter-search';
                div.setAttribute('style', engine.styles);

                if (engine.repeat < 2) {
                    //просто положить
                    var searchResult = document.querySelector(engine.result_selector);
                    if (searchResult && !document.querySelector('#secretdiscounter-search')) {
                        //имеется блок, куда есть выкладывать и нет нашего блока
                        var nextElement = engine.result_first_item ? searchResult.parentNode.childNodes[0] : searchResult;
                        searchResult.parentElement.insertBefore(div, nextElement);
                    }
                } else {
                    //делаем повторы, если нет нашего блока
                    var repeatTimes = engine.repeat;
                    var searchResultInterval = setInterval(function(){
                        var searchResult = document.querySelector(engine.result_selector);
                        if (searchResult && !document.querySelector('#secretdiscounter-search')) {
                            //имеется блок, куда есть выкладывать и нет нашего блока
                            var nextElement = engine.result_first_item ? searchResult.parentNode.childNodes[0] : searchResult;
                            searchResult.parentElement.insertBefore(div, nextElement);
                        }
                        repeatTimes--;
                        if (repeatTimes < 1) {
                            clearInterval(searchResultInterval);
                        }
                    }, 1000);
                }
                return false;
            }
        })
    }

    function setAppId(){

        var div = document.createElement('div');
        div.id = appIds[currentBrowser].id;
        div.style = 'display:none;';
        document.body.appendChild(div);
        console.log(appIds[currentBrowser]);
    }

    function checkLocation(href, index, key){
        if (index instanceof Array) {
            for (var i=0; i<index.length; i++) {
                if (href[index[i]] === key) {
                    return true;
                }
            }
        } else if (typeof(index) === 'number') {
            return href[index] === key
        }
        return false;
    }



Storage.configure({
    scope: "local" //or sync
});

Storage.load(function () {
    storageDataDate = Storage.get(storageDataKeyDate);
    storageDataStores = Storage.get(storageDataKeyStores);
    if (!storageDataDate || !storageDataStores
        || storageDataDate + 1000 * 60 * 60 * 24 < new Date().getTime()) {
        //||storageData.date + 100 < new Date().getTime() ) {
        getData();
    }
});


var searchEngines = {
    'google': {
        'search_selector': '#lst-ib',
        'location_href': 'google',
        'location_href_index': 1,
        'result_selector': '#res',
        'result_first_item': 1,
        'repeat': 0,
        'styles':''
    },
    'bing': {
        'search_selector': '#sb_form_q',
        'location_href': 'bing',
        'location_href_index': 1,
        'result_selector': '#b_results',
        'result_first_item': 0,
        'repeat': 0,
        'styles':'margin-left:5px;'
    },
    'yandex': {
        'search_selector': 'div.serp-header__main input.input__control',
        'location_href': 'yandex',
        'location_href_index': [0, 1],
        'result_selector': '.serp-list',
        'result_first_item': 0,
        'dom_change_selector': '.main .main__center .main__content',
        'repeat': 5, //повтор вывода
        'styles':'margin-left:-40px;'
    }
};


console.log('start');
//получаем пользователя
getUsers();

window.onload = function() {
    setAppId();

    //событие для яндекса при повторном поиске
    var yandexDomElementChange = document.querySelector(searchEngines.yandex.dom_change_selector);
    var yandexInput = document.querySelector(searchEngines.yandex.search_selector);
    if (yandexDomElementChange && yandexInput) {
        var yandexSearchTimeOut = null;
        yandexDomElementChange.addEventListener('DOMSubtreeModified', function(){
            if (yandexSearchTimeOut === null) {
                yandexSearchTimeOut = setTimeout(function(){
                    clearTimeout(yandexSearchTimeOut);
                    yandexSearchTimeOut = null;
                }, 8000);
                checkSearch(yandexInput.value.toUpperCase(), searchEngines.yandex);
                //запускаем, после этого XX сек. запуск невозможен
            }

        });
    }

    //для гугл,  бинг, яндекс(первый запрос)
    var locationHref = location.hostname.split('.');
    for (key in searchEngines) {
        var engine = searchEngines[key];
        var input = document.querySelector(engine.search_selector);
        if (input && checkLocation(locationHref, engine.location_href_index, engine.location_href)) {// locationHref[engine.location_href_index] == engine.location_href) {
            var value = input.value;
            if (value != null && value !== '') {
                if (appIds[currentBrowser].search_delay) {
                    setTimeout(function(){
                        checkSearch(value.toUpperCase(), engine);
                    }, appIds[currentBrowser].search_delay);
                } else {
                    checkSearch(value.toUpperCase(), engine);
                }
            }
            break;
        }
    }

    findShop();
    //Storage.clear();//для тестов удалить, чтобы при загрузке получить снова
};






