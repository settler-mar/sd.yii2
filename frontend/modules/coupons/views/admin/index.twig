{{ use('/yii/grid/GridView') }}
{% set title = 'Купоны' %}
{{ set(this, 'title', title) }}
{% if not this.params.breadcrumbs %}
  {{ set(this, 'params', this.params|merge({'breadcrumbs': []})) }}
{% endif %}
{% set breadcrumbs = this.params.breadcrumbs %}
{% set breadcrumbs = breadcrumbs|merge([title]) %}
{{ set(this, 'params', this.params|merge({'breadcrumbs': breadcrumbs})) }}
<div class="coupons-index">
  <div class="content-wrapper">
    <section>
      <div class="row">
        <h1>{{ html.encode(this.title) }}</h1>
        <div class="col-md-6">
          <p class="add-item">Купоны автоматически удаляются раз в час и добавляются раз в сутки.</p>
          <p class="add-item">Функция удаления отключенна для отображения купонов в архиве.</p>
        </div>
        <div class="col-md-6">
          <div class="sum_information">
            <div class="line">
              <div class="name wide">
                Все (активные/просроченные)
              </div>
              <div class="value">
                <a class="" href="/admin/coupons{{ _getFilterAdd({}, app.request.get, 'CouponsSearch') }}">{{ total_filtered }}</a>
                (<a class="" href="/admin/coupons{{ _getFilterAdd({'is_active': 1}, app.request.get, 'CouponsSearch') }}">{{ active_filtered }}</a>/<a class="" href="/admin/coupons{{ _getFilterAdd({'is_active': 0}, app.request.get, 'CouponsSearch') }}">{{ inactive_filtered }}</a>)
              </div>
            </div>

          {% for cpa in stat_cpa %}
            <div class="line">
              <div class="name wide">
                  {{ cpa.name }}
              </div>
              <div class="value">
                <a class="" href="/admin/coupons{{ _getFilterAdd({'cpaName': cpa.id}, app.request.get, 'CouponsSearch') }}">{{ cpa.count }}</a>
                (<a class="" href="/admin/coupons{{ _getFilterAdd({'cpaName': cpa.id, 'is_active': 1}, app.request.get, 'CouponsSearch') }}">{{ cpa.active }}</a>{% if cpa.inactive %}/<a class="" href="/admin/coupons{{ _getFilterAdd({'cpaName': cpa.id, 'is_active': 0}, app.request.get, 'CouponsSearch') }}">{{ cpa.inactive }}</a>{% endif %})
              </div>
            </div>
          {% endfor %}
          {% for lang, lang_count in stat_lang %}
            <div class="line">
              <div class="name wide">
                  {% if loop.index == 1 %}Языки {% endif %}{{ lang }}
              </div>
              <div class="value">
                <a class="" href="/admin/coupons{{ _getFilterAdd({'languages': lang}, app.request.get, 'CouponsSearch') }}">{{ lang_count }}</a>
              </div>
            </div>
          {% endfor %}
            <div class="line">
              <div class="name wide">
                Сбросить фильтр
              </div>
              <div class="value">
                <a class="" href="/admin/coupons">{{ total }}</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          {{ grid_view_widget({
            'dataProvider': dataProvider,
            'pager' : {
              'firstPageLabel' : true,
              'lastPageLabel' : true,
              'maxButtonCount':20
            },

            'filterModel': searchModel,
            'columns': [
              {'class': '\\yii\\grid\\SerialColumn'},

              'uid',
              'coupon_id',
              {
                 'format': 'raw',
                  'attribute':'name',
                  'value': tableData.name
              },
              {
                'format':'raw',
                'attribute':'storeName',
              },
              'description:ntext',
              'visit',
              {
                'format':'raw',
                'attribute': 'reviews_count',
                'value': tableData.reviewsCount,
                'filter':{
                  1:"Нет",
                  2:"Есть",
                }
              },
              {
                'format':'raw',
                'attribute':'date_start',
                'headerOptions' : {
                'class' : 'col-md-2'
              },
                'filter': startDataRanger
              },
              {
                'format':'raw',
                'attribute':'date_end',
                'headerOptions' : {
                'class' : 'col-md-2'
              },
                'filter': endDataRanger
              },{
                'format':'raw',
                'attribute':'cpaName',
                'filter': cpaNames
              },
              {'class': '\\yii\\grid\\ActionColumn',
                'template' : '{update} {delete}',
              },
            ],
          }) }}
        </div>
      </div>
    </section>
  </div>
  {#
  'date_end',
  'goto_link',
  'promocode',
  'exclusive',
  'species',
  'visit',
  'store_id'
  #}
</div>