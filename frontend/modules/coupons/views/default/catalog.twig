{% if h1 %}
    {#h1 из базы#}
    {% set h1_final =  h1 %}
{% else %}
    {#если нет, то#}
    {% if current_category.name != '' %}
        {% set h1_final =  t('main', '{category} coupons default h1 category {date}', {'category': current_category.name, 'date': _local_date('', '%BRUS %G', true)}) %}
    {% elseif current_store.name != '' %}
        {% set h1_final = t('main', 'coupons default h1 {store} - {date}', {'store': current_store.name, 'date': _local_date('', '%BRUS %G', true)}) %}
    {% else %}
        {% set h1_final = t('main', 'coupons default h1 <a href="{href}">stores</a>', {'href': _href('/stores')}) %}
    {% endif %}
    {% set h1_final = h1_final~'<span>('~total_v~')</span>' %}
{% endif%}

    {% if (content or current_category.description) and pagination_page==1%}
      <section class="gray-box wrap-round margin catalog_category-content">
        <h1 class="align-center laptop-no-margin-bottom page-header">{{ h1_final|raw }}</h1>
          <div class="laptop_hide">
            {% if current_category.description %}
              {{ _tags_class(current_category.description,{'a':'blue'})| raw }}
            {% else %}
              {{ _tags_class(content, {'a':'blue'}) | raw}}
            {% endif %}
          </div>
      </section>
    {% endif %}

    <section class="catalog margin">
        <div class="page-wrap page-wrap-flex">
            {#слева категории#}
            <div class="catalog-categories">
                {% include('left_menu.twig') %}
            </div>
            {#справа шопы#}
            <div class="catalog-stores coupons ">

                {% if ((content==null or content=='')
                    and (current_category.description == null or current_category.description == ''))
                    or page > 1 %}
                    <h1 >{{ h1_final|raw }}</h1>
                {% endif %}

                {#кнопка категории#}
                <div class="catalog-categories_tree-toggle">
                    {{ svg('bars-slim', 'catalog-categories_tree-toggle-icon catalog-categories_tree-toggle-icon-close')|raw }}
                    {{ svg('close', 'catalog-categories_tree-toggle-icon catalog-categories_tree-toggle-icon-open')|raw }}
                    <span class="catalog-categories_tree-toggle-tittle">{{ t('main', 'stores_change_category')|raw }}</span>
                </div>

                {#выбор и отображение сортировки#}
                <div class="margin-half page-wrap-flex catalog-stores_sort">
                    {% include('parts/list_type_switcher.twig') %}

                    {% include('parts/sort-links.twig') %}

                    <div class="catalog-stores_sort-info">
                        {{ t('main','show_{start}-{end}_from_{total}', {'start':  (total_v > 0 ? offset_coupons + 1 : '0'), 'end': offset_coupons + show_coupons, 'total': total_v})|raw }}
                     </div>
                </div>

                {% if current_store == null and search_result == null %}
                    {#алфавитный поиск при отсутствии шопа#}
                    <div class="coupons-abc">
                        <div  class="coupons-abc_chars">
                            {% for char, stores in stores_abc|slice(0, 27) %}
                                {% if stores|length and stores_abc_w != char %}
                                    {% set href = '/coupons'~(current_category and current_category.route  and current_category.route !='/' ? '/'~current_category.route : '')~'?w='~char %}
                                    <a class="ajax_load" href="{{ _href(href)|raw }}">{{ char|raw }}</a>
                                {% else %}
                                    <span {% if stores_abc_w == char %}class="active"{% endif %}>{{ char|raw }}</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div  class="coupons-abc_chars row-2">
                            {% for char, stores in stores_abc|slice(27) %}
                                {% if stores|length and stores_abc_w != char %}
                                    {% set href = '/coupons'~(current_category and current_category.route  and current_category.route !='/' ? '/'~current_category.route : '')~'?w='~char %}
                                    <a class="ajax_load" href="{{ _href(href)|raw }}">{{ char|raw }}</a>
                                {% else %}
                                    <span {% if stores_abc_w == char %}class="active"{% endif %}>{{ char|raw }}</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <div class="category-title-wrapper">
                    {% include 'parts/dropdown-limit-catalog.twig' %}
                </div>
                <div  class="catalog-coupons {% if pagination|length == 0 %}margin-half{% else %}margin{% endif %}">
                    {% if coupons|length > 0 %}
                        <div class="catalog_list catalog-coupons_list coupons-list {{ _if(coupons_view=='narrow'," narrow",'') }}">
                          {% if coupons|length > 0 %}
                            {% for coupon in coupons %}
                                  {% include 'parts/coupon.twig' %}
                            {% endfor %}
                            <div class="coupons coupons-empty"></div>
                            <div class="coupons coupons-empty"></div>
                            <div class="coupons coupons-empty"></div>
                            <div class="coupons coupons-empty"></div>
                            <div class="coupons coupons-empty"></div>
                            <div class="coupons coupons-empty"></div>
                          {% else %}
                              {{ t('main', 'not_found')|raw }}
                          {% endif %}
                        </div>


                        {% include('parts/pagination.twig') %}


                    {% else %}
                        <p>{{ t('main', 'not_found')|raw }}</p>
                    {% endif %}
                </div>

                {% if expired == 1 %}
                    <div class="coupons_buttons align-center">
                        {% if counts.actual > 0 and current_store %}
                        <div class="coupons_buttons-top">
                            <a class="btn btn-narrow btn-transform coupons_buttons-margin" href="{{ _href('/coupons/expired')|raw }}"><span>{{ t('main', 'coupons_show_all_expired')|raw }} ({{ counts_all.expired }})</span></a>
                        </div>
                        {% endif %}
                        <div class="coupons_buttons-bottom">
                            {% if counts.actual > 0 %}
                                {% if current_store %}
                                    <a class="btn btn-transform  btn-mini btn-round coupons_buttons-margin" href="{{ _href('/coupons/'~current_store.routeUrl)|raw }}"><span>{{ t('main', 'coupons_show_all_for_shop')|raw }} ({{ counts.actual }})</span></a>
                                {% endif %}
                                {% if current_category %}
                                    <a class="btn btn-mini btn-transform btn-round coupons_buttons-margin" href="{{ _href('/coupons/'~current_category.route)|raw }}"><span>{{ t('main','coupons_show_all_for_category')|raw }} ({{ counts.actual }})</span></a>
                                {% endif %}
                            {% endif %}
                            <a class="btn btn-mini  btn-round coupons_buttons-margin" href="{{ _href('/coupons') }}"><span>{{ t('main', 'coupons_all')|raw }} ({{ total_all_coupons }})</span></a>
                        </div>
                    </div>
                {% endif %}

              <!--краткая информация категории-->
              {% if current_category.short_description %}
                <div class="catalog_category-content margin">
                  <div class="catalog_category-short-description catalog_category-content">
                    {{_tags_class(current_category.short_description,{'a':'blue'})|raw}}
                  </div>
                </div>
              {% endif %}

              <!--краткая информация о магазине для купона-->
              {% if current_store.coupon_description and pagination_page==1 and expired != 1 %}
                <div class="catalog_category-content margin">
                  <div class="catalog_category-short-description catalog_category-content">
                    {{ _tags_class(current_store.coupon_description,{'a':'blue'})|raw }}
                  </div>
                </div>
              {% endif %}

              {% if current_store and counts.expired>0 and expired == null %}
                {% include('parts/coupon_ended_list.twig') %}
              {% endif %}

              {% if expired == null and counts.expired %}
                <div class="coupons_buttons align-center">
                  {% if current_store %}
                    <a class="btn btn-transform btn-narrow coupons_buttons-margin" href="{{ _href('/coupons/'~current_store.routeUrl~'/expired')|raw }}"><span>{{ t('main', 'coupons_show_all_expired')|raw }} ({{ counts.expired }})</span></a>
                  {% elseif current_category %}
                    <a class="btn btn-transform btn-narrow coupons_buttons-margin" href="{{ _href('/coupons/'~current_category.route~'/expired')|raw }}"><span>{{ t('main', 'coupons_all_expired')|raw }} ({{ counts.expired }})</span></a>
                  {% else %}
                    <a class="btn btn-transform btn-narrow coupons_buttons-margin" href="{{ _href('/coupons/expired')|raw }}"><span>{{ t('main', 'coupons_all_expired')|raw }} ({{ counts.expired }})</span></a>
                  {% endif %}
                </div>
              {% endif %}

              {% if (is_root or new or top) and pagination_page==1 and expired == null %}
                <div class="catalog_category-content">
                  <div class="catalog_category-short-description catalog_category-content">
                    {% if is_root %}
                        {{ _constant('coupons_main') | raw}}
                    {% elseif new %}
                        {{ _constant('coupons_new') | raw}}
                    {% elseif top %}
                        {{ _constant('coupons_top') | raw}}
                    {% endif %}
                  </div>
                </div>
              {% endif %}

            </div>
        </div>
    </section>
