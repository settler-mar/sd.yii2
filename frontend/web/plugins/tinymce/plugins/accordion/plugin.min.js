tinymce.PluginManager.add('accordion', function(editor, url) {
  // Add a button that opens a window
  editor.addButton('accordion', {
    type: 'menubutton',
    text: 'Accordion',
    icon: false,
    //onclick: accordionAdd,
    stateSelector: 'div.accordion *',
    menu: [
      {
        text: 'Подробнее-скрыть',
        onclick: accordionAdd.bind(1)
      },
      {
        text: 'С шапкой',
        onclick: accordionAdd.bind(2)
      }
      {
        text: 'С шапкой(slim)',
        onclick: accordionAdd.bind(3)
      }
    ]
  });


  function accordionAdd() {
    // Top most window object
    win = editor.windowManager.getWindows()[0];
    current = $(editor.selection.getNode()).closest('.accordion');
    type = this;
    var blk='';
    var selectedText = '';

    if (current.length > 0) {
      return;
    }
    selectedText = editor.selection.getContent();

    if (type==1) {
      blk += '<div class="accordion">' +
        '<div class="accordion-content">' + selectedText + '</div>' +
        '<div class="accordion-control">' +
        '<a href="#" class="angle-down"><i class="icon">&nbsp;</i></a>' +
        '<a href="#" class="angle-up"><i class="icon">&nbsp;</i></a>' +
        '</div>' +
        '</div><br>';
    }
    if (type==2) {
      blk += '<div class="accordion">' +
        '<div class="accordion-control accordion-title">' +
        '&nbsp;' +
        '</div>' +
        '<div class="accordion-content">' + selectedText + '</div>' +
        '</div><br>';
    }
    if (type==3) {
      blk += '<div class="accordion accordion-slim">' +
        '<div class="accordion-control accordion-title">' +
        '&nbsp;' +
        '</div>' +
        '<div class="accordion-content">' + selectedText + '</div>' +
        '</div><br>';
    }
    editor.insertContent(blk);
  }
});
