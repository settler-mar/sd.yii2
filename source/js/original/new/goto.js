(function(){

    $('.coupons-list_item-content-goto-promocode-link').click(function(e){
        var that = $(this);
        var expired = that.closest('.coupons-list_item').find('.clock-expired');
        var userId = $(that).data('user');
        var inactive = $(that).data('inactive');
        var data_message = $(that).data('message');

        if (inactive) {
            var title = data_message ? data_message : 'К сожалению, промокод неактивен';
            var message = 'Все действующие промокоды вы можете <a href="/coupons">посмотреть здесь</a>';
            notification.alert({
                'title': title,
                'question': message,
                'buttonYes': 'Ok',
                'buttonNo': false,
                'notyfy_class': 'notify_box-alert'
            });
            return false;
        }  else if (expired.length > 0) {
            var title = 'К сожалению, срок действия данного промокода истек';
            var message = 'Все действующие промокоды вы можете <a href="/coupons">посмотреть здесь</a>';
            notification.alert({
                'title': title,
                'question': message,
                'buttonYes': 'Ok',
                'buttonNo': false,
                'notyfy_class': 'notify_box-alert'
            });
            return false;
        } else if (!userId) {
            var data={
                'buttonYes':false,
                'notyfy_class': "notify_box-alert",
                'title': 'Использовать промокод',
                'question':
                    '<div class="notify_box-coupon-noregister">'+
                        '<img src="/images/templates/swa.png" alt="">'+
                        '<p><b>Если вы хотите получать еще и КЭШБЭК (возврат денег), вам необходимо зарегистрироваться. Но можете и просто воспользоваться промокодом, без кэшбэка.</b></p>'+
                    '</div>'+
                    '<div class="notify_box-buttons">'+
                        '<a href="'+that.attr('href')+'" target="_blank" class="btn">Использовать промокод</a>'+
                        '<a href="#registration" class="btn btn-transform modals_open">Зарегистрироваться</a>'+
                    '</div>'
            };
            notification.alert(data);
            return false;
        }
    });

}());